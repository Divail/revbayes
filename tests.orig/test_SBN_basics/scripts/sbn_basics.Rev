################################################################################
#
# RevBayes Test-Script: Fitting an SBN via regularized EM
#
#
# authors: Andrew Magee
#
################################################################################

seed(12345)

# Read in the trees to fit the SBN
treetrace = readTreeTrace("data/DS1.trees",treetype="non-clock")
treetrace.setBurnin(0)

# Fit an SBN with EM-A algorithm, 10 EM steps, no branch lengths
sbn = treetrace.learnUnconstrainedSBN("EMA",regularizationAlpha=0.5,"pureTopology",minimumIterations=10,maximumIterations=10)
x ~ dnUnconstrainedSBN(sbn)

# Compute probabilities of input trees under the SBN
write("",file="output/Test_sbn_basics.txt",append=false)
for (i in 1:100) {
  x.setValue(treetrace.getTree(i))
  write(exp(x.lnProbability()),"\n",file="output/Test_sbn_basics.txt",append=true)
}

q()
